# Геопривязка растра {#georeferencing}

В качестве исходной информации при векторизации, как правило, выступают растровые изображения. Это могут быть отсканированные оригиналы бумажных карт, выдержки из официальной документации, информация с градостроительных порталов, из градостроительной документации, спутниковые снимки или снимки, полученные с беспилотных летательных аппаратов, даже просто скриншоты экрана, а также тайловые подложки (типа той, что мы подгружаем из OpenStreetMap).

**Геопривязка растра** - это присвоение растровому изображению нужной географической системы координат.

В процессе привязки на растровом изображении для каждого пикселя, у которого есть условные координаты на растре, находится соотвествующая координата в целевой системе координат.

В качестве исходных данных возьмем информацию с Градостроительного портала Санкт-Петербурга <https://portal.kgainfo.spb.ru/KGAMap/Map>

![](images/37.PNG)

Этот портал позволяет получать информацию из градостроительной документации Санкт-Петербурга, но только в растровом виде, выгрузки границ объектов в векторных форматах здесь не предусмотрено. Поэтому, если вы хотите воспользоваться данными портала, вам нужно будет из самостоятельно векторизовать.

Рассмотрим пример сохранения растровой картинки с границами функциональной зоны.

Для этого найдем на карте интересующую нас зону, щелкнем на нее, чтобы получить информацию об объектах в точке.

![](images/38.png)

Далее выберем фунцию печати информации об функциональной зоне, после чего в новой вкладке откроется отчет с подробной информацией и схемой расположения объекта.

Просто сохраним картинку из отчета, чтобы в дальнейшем открыть ее в QGIS, выполнить геопривязку и осуществить векторизацию.

Создадим новый проект (рекомендую либо сразу его создавать в системе координат `EPSG:3857`, либо сразу после создания перепроецировать на лету в эту систему координат).

Для геопривязки растровых изображений в QGIS существует встроенный инструмент [**Georeferencer**](https://docs.qgis.org/3.28/en/docs/user_manual/working_with_raster/georeferencer.html) (может называться Геопривязка).

![](images/39.png)

Далее откроется окно геопривязки растра.

![](images/40.PNG)

В первую очередь нужно задать или проверить параметры трансформации растра (в строке меню *Параметры --- Параметры трансформации*).

![](images/41.PNG)

Основные параметры здесь:

-   тип трансформации - алгоритм преобразования растрового изображения, подробнее [здесь](https://docs.qgis.org/3.28/en/docs/user_manual/working_with_raster/georeferencer.html#available-transformation-algorithms);

-   метод интерполяции;

-   целевая система координат - система координат, которую вы хотите присвоить растру;

-   целевой растр - нужно указать путь и название файла, полученного в результате привязки.

Для выполнения привязки нужно открыть растр ![](images/42.PNG), указать контрольные точки и их координаты в целевой системе координат.

![](images/43.PNG)

Контрольные точки - это точки, по которым будет осуществляться привязка растрового изображения. У этих точек известны координаты на растровом изображении (как правило, в пикселях) и в целевой системе координат, то есть фактически по этим точкам растр "усаживается" в нужное место на карту.

Чтобы поставить контрольную точку, нужно щелкнуть на нее в окне привзяки на растре, а далее указать ее координаты в диалоговом окне.

![](images/44.PNG)

Координаты можно ввести с клавиатуры (если они у вас есть), либо выбрать вариант **С карты** и просто щеклнуть на ту же самую точку на карте, после чего эти координаты пропишутся в диалоговом окне автоматически.

В качестве контрольных точек лучше всего использовать какие-то жесткие контура, на которых вы однозначно можете указать конкретную точку: угол дома, перекресток, угол парка и что-нибудь подобное.

Для различных вариантов трансформации рекомендуется разное минимальное число контрольных точек, но, как правило, общая рекомендация использовать не менее 3 точек. Желательно, чтобы эти точки не были расположены на одной линии.

После того, как вы укажете все контрольные точки и их координаты на карте, они будут отображены в таблице под растровым изображением в окне привязки.

![](images/45.PNG)

Контрольные точки привязки можно сохранить и потом использовать в дальнейшем в других проектах (но только для того же самого растра).

Для завершения процесса привязки нужно нажать **Начать привязку растра** ![](images/46.PNG) после чего растр будет модифицирован и отобразиться в нужном месте на карте.

![](images/47.PNG)

Этот модифицированный растр уже будет иметь в себе сведения о системе координат и его местоположении, поэтому его потом можно будет использовать в дальнейших проектах уже без процесса привязки.
